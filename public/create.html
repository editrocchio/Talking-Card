<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Page Title</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
  <script src="main.js"></script>
  <!-- JQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.7.2/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyCT93pdmlknF9fFq4bHM7mpiF_45hZWraw",
      authDomain: "co-op-hackathon.firebaseapp.com",
      databaseURL: "https://co-op-hackathon.firebaseio.com",
      projectId: "co-op-hackathon",
      storageBucket: "",
      messagingSenderId: "86999184000"
    };
    firebase.initializeApp(config);
  </script>
  <style>
    .row{
            display: flex;
        }
        #addButton{
            float: right;
        }
    </style>
</head>

<body>
  <div id="deckContainer">
    <h1 id="deckName">Deck Name</h1>
    <button id="addButton" onclick="addCard()">Add Card</button>
  </div>
  <div id="cardsContainer">
    <form id="cards">
      <div class="row" id="row1">
        <div class="question">
          <textarea id="question1" placeholder="Question"></textarea>
        </div>
        <div class="answer">
          <textarea id="answer1" placeholder="Answer"></textarea>
        </div>
        <div class="remove">
          <button id="button1" onclick="removeCard('row1')">-</button>
        </div>
      </div>
      <div id="row">
        <input type="submit" value="Create Deck">
      </div>
    </form>
  </div>
  <script>
    window.onload = loadCards();

    let deckName = sessionStorage.getItem("deckName");
    document.getElementById("deckName").innerHTML = deckName;
    document.getElementById("cards").addEventListener('submit', saveCards)
    let uniqueCard = 2;
    function addCard() {
      let cards = document.getElementById("cards");
      //create new row
      let newRow = document.createElement("div");
      newRow.className = "row";
      let newRowID = "row" + parseInt(uniqueCard);
      newRow.id = newRowID;
      //create question 
      let newQuestionDiv = document.createElement("div");
      let newQuestion = document.createElement("textarea");
      let newQuestionID = "question" + parseInt(uniqueCard);
      newQuestion.id = newQuestionID;
      newQuestion.placeholder = "Question";
      newQuestionDiv.appendChild(newQuestion);
      newRow.appendChild(newQuestionDiv);
      //create Answer
      let newAnswerDiv = document.createElement("div");
      let newAnswer = document.createElement("textarea");
      let newAnswerID = "answer" + parseInt(uniqueCard);
      newAnswer.id = newAnswerID;
      newAnswer.placeholder = "Answer";
      newAnswerDiv.appendChild(newAnswer);
      newRow.appendChild(newAnswerDiv);
      //create button
      let newButtonDiv = document.createElement("div");
      let newButton = document.createElement("button");
      let newButtonID = "button" + parseInt(uniqueCard);
      newButton.id = newButtonID;
      newButton.innerHTML = "-";
      newButton.onclick = function () { removeCard(newRowID); }
      newButtonDiv.appendChild(newButton);
      newRow.appendChild(newButtonDiv)
      //add row to cards
      $(newRow).insertBefore('#cards > div:last')
      uniqueCard += 1;
    }
    function removeCard(rowID) {
      document.getElementById("cards").removeChild(document.getElementById(rowID));
    }
    function saveCards(e) {
      e.preventDefault();
      let deckName = document.getElementById("deckName").innerHTML;
      let questionNumber = 1;
      for (let i = 1; i < uniqueCard; i++) {
        let card = document.getElementById("row" + parseInt(i));
        if (card !== null) {
          console.log("made it")
          let question = document.getElementById("question" + parseInt(i)).value;
          let answer = document.getElementById("answer" + parseInt(i)).value;
          if (question != "" && answer != "") {
            firebase.database().ref(deckName + '/question ' + parseInt(questionNumber)).set({
              question: question,
              answer: answer
            })
            questionNumber += 1;
          }
        }
      }
      setTimeout(function () { window.location.href = "./review.html"; }, 1000);
    }
    function loadCards() {
      let currentDeck = sessionStorage.getItem("deckName");
      let arr = []
      firebase.database().ref(currentDeck + "/").once(
        'value',
        function (snapshot) {
          for (var deck in snapshot.val()) {
            var question = snapshot.val()[deck]['question'];
            var answer = snapshot.val()[deck]['answer'];
            displayCard(question, answer);
          }
        });
    }
    function displayCard(question, answer) {
      let cards = document.getElementById("cards");
      //create new row
      let newRow = document.createElement("div");
      newRow.className = "row";
      let newRowID = "row" + parseInt(uniqueCard);
      newRow.id = newRowID;
      //create question 
      let newQuestionDiv = document.createElement("div");
      let newQuestion = document.createElement("textarea");
      let newQuestionID = "question" + parseInt(uniqueCard);
      newQuestion.id = newQuestionID;
      newQuestion.placeholder = "Question";
      newQuestion.innerHTML = question;
      newQuestionDiv.appendChild(newQuestion);
      newRow.appendChild(newQuestionDiv);
      //create Answer
      let newAnswerDiv = document.createElement("div");
      let newAnswer = document.createElement("textarea");
      let newAnswerID = "answer" + parseInt(uniqueCard);
      newAnswer.id = newAnswerID;
      newAnswer.placeholder = "Answer";
      newAnswer.innerHTML = answer;
      newAnswerDiv.appendChild(newAnswer);
      newRow.appendChild(newAnswerDiv);
      //create button
      let newButtonDiv = document.createElement("div");
      let newButton = document.createElement("button");
      let newButtonID = "button" + parseInt(uniqueCard);
      newButton.id = newButtonID;
      newButton.innerHTML = "-";
      newButton.onclick = function () { removeCard(newRowID); }
      newButtonDiv.appendChild(newButton);
      newRow.appendChild(newButtonDiv)
      //add row to cards
      cards.insertBefore(newRow, cards.firstChild);
      uniqueCard += 1;
    }
  </script>
</body>

</html>
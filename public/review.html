<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Page Title</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet"
    type="text/css">

  <!-- Custom styles for this template -->
  <link href="css/review.css" rel="stylesheet">
</head>

<body>
  <h1 id="deck_name" class="deck_name">
    <div class="spinner-border" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </h1>
  <p class="question_number">1</p>
  <div class="question">
    <p>
      <div class="spinner-border" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </p>
  </div>
  <div class="answer">
    <p>
      <div class="spinner-border" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </p>
  </div>
  <input type="button" value="Previous" id="previous_question" class="previous_question">
  <input type="button" value="Next" id="next_question" class="next_question">
  <input type="button" value="Show Answer" id="get_answer" class="get_answer">
  <input type="button" value="Edit Deck" class="add_question" id="add_answer">

  <script src="https://www.gstatic.com/firebasejs/5.7.2/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyCT93pdmlknF9fFq4bHM7mpiF_45hZWraw",
      authDomain: "co-op-hackathon.firebaseapp.com",
      databaseURL: "https://co-op-hackathon.firebaseio.com",
      projectId: "co-op-hackathon",
      storageBucket: "",
      messagingSenderId: "86999184000"
    };
    firebase.initializeApp(config);
  </script>
  <script>
    var deckName = sessionStorage.getItem("deckName");

    class Card {
      constructor(question, answer) {
        this.questionNumber = questionNo;
        this.question = question;
        this.answer = answer;

        questionNo++;
      }
    }

    var questionNo = 1;
    var cards = loadDeck(getDeckName());
    var cardIndex = 0;
    var displayAnswer = false;

    function getDeckName() {
      // Receive deck name from other page
      return deckName;

    }

    function loadDeck(deckName) {
      var decks = firebase.database().ref(deckName);
      var arr = [];
      decks.on('value', function (snap) {

        for (var deck in snap.val()) {

          var question = snap.val()[deck]['question'];
          var answer = snap.val()[deck]['answer'];
          var card = new Card(question, answer);
          arr.push(card);
        }
        firstQuestion(arr);
      });
      return arr;

    }

    function firstQuestion(listofcards) {
      displayQuestion(listofcards[cardIndex].question, listofcards[cardIndex].answer, listofcards[cardIndex].questionNumber);
    }

    function nextQuestion() {
      if (cardIndex == cards.length - 1) {
        cardIndex = 0;
      } else {
        cardIndex++;
      }
      displayQuestion(cards[cardIndex].question, cards[cardIndex].answer, cards[cardIndex].questionNumber);
      console.log(cardIndex);
      hideAnswer();
    }

    function previousQuestion() {
      if (cardIndex == 0) {
        cardIndex = cards.length - 1;
      } else {
        cardIndex--;
      }
      console.log(cardIndex);
      displayQuestion(cards[cardIndex].question, cards[cardIndex].answer, cards[cardIndex].questionNumber);
      hideAnswer();

    }

    function displayQuestion(question, answer, questionNumber) {
      document.getElementsByClassName('question')[0].innerHTML = question;
      document.getElementsByClassName('answer')[0].innerHTML = answer;
      document.getElementsByClassName('question_number')[0].innerHTML = questionNumber;
    };

    function displayDeckName() {
      document.getElementById('deck_name').innerHTML = getDeckName();
    }

    function showAnswer() {
      document.getElementsByClassName('answer')[0].style.visibility = 'visible';
      displayAnswer = true;
      document.getElementById("get_answer").value = "Hide Answer";
    }

    function hideAnswer() {
      document.getElementsByClassName('answer')[0].style.visibility = 'hidden';
      displayAnswer = false;
      document.getElementById("get_answer").value = "Show Answer";
    }

    function toggleAnswer() {
      if (displayAnswer) {
        hideAnswer();
      } else {
        showAnswer();
      }
    }

    function addAnswer() {
      passDeckName(deckName);
      window.location.href = "create.html";
    }
    function passDeckName(name) {
      sessionStorage.setItem('deckName', name);
    }
    document.getElementById("previous_question").addEventListener('click', previousQuestion);
    document.getElementById("next_question").addEventListener('click', nextQuestion);
    document.getElementById("get_answer").addEventListener('click', toggleAnswer);
    document.getElementById("add_answer").addEventListener('click', addAnswer);

    displayDeckName();

    var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
    var SpeechGrammarList = SpeechGrammarList || webkitSpeechGrammarList;
    var SpeechRecognitionEvent = SpeechRecognitionEvent || webkitSpeechRecognitionEvent;

    var commands = [ 'next' , 'answer', 'add' ];
    var grammar = '#JSGF V1.0; grammar commands; public <command> = ' + commands.join(' | ') + ' ;'

    var recognition = new SpeechRecognition();
    speechRecognitionList = new SpeechGrammarList();
    speechRecognitionList.addFromString(grammar, 1);

    recognition.grammars = speechRecognitionList;
    //recognition.continuous = false;
    recognition.lang = 'en-US';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;


    document.addEventListener('keydown', function(event) {
        if(event.keyCode == 32) {
            console.log('Ready to receive a command.');
            recognition.start();
        }
    });

    recognition.onresult = function(event) {
      var last = event.results.length - 1;
      var word = (event.results[last][0].transcript);

      if(word == "next") {
        nextQuestion();
      } else if(word == "answer") {
        showAnswer();
      } else if(word == "add") {
        //
      }
    }
    //Stops it after a word has been spoken
    recognition.onspeechend = function() {
      recognition.stop();
    }

    recognition.onnomatch = function(event) {
      diagnostic.textContent = 'I didnt recognise that command.';
    }

  </script>
</body>

</html>

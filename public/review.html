<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Page Title</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--<link rel="stylesheet" type="text/css" media="screen" href="main.css" />-->

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
    crossorigin="anonymous">
  <style>
    .answer{
      visibility: hidden;
    }
  </style>
</head>

<body>
  <h1 id="deck_name" class="deck_name">
    <div class="spinner-border" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </h1>
  <p class="question_number">1</p>
  <div class="question">
    <p>
      <div class="spinner-border" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </p>
  </div>
  <div class="answer">
    <p>
      <div class="spinner-border" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </p>
  </div>
  <input type="button" value="Previous" id="previous_question" class="previous_question">
  <input type="button" value="Next" id="next_question" class="next_question">
  <input type="button" value="Show Answer" id="get_answer" class="get_answer">
  <input type="button" value="Edit Deck" class="add_question" id="add_answer">

  <script src="https://www.gstatic.com/firebasejs/5.7.2/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyCT93pdmlknF9fFq4bHM7mpiF_45hZWraw",
      authDomain: "co-op-hackathon.firebaseapp.com",
      databaseURL: "https://co-op-hackathon.firebaseio.com",
      projectId: "co-op-hackathon",
      storageBucket: "",
      messagingSenderId: "86999184000"
    };
    firebase.initializeApp(config);
  </script>
  <script>
    var deckName = sessionStorage.getItem("deckName");
    sessionStorage.clear();

    class Card {
      constructor(question, answer) {
        this.questionNumber = questionNo;
        this.question = question;
        this.answer = answer;

        questionNo++;
      }
    }

    var questionNo = 1;
    var cards = loadDeck(getDeckName());
    var cardIndex = 0;
    var displayAnswer = false;

    function getDeckName() {
      // Receive deck name from other page
      return deckName;
      
    }

    function loadDeck(deckName) {
      var decks = firebase.database().ref(deckName);
      var arr = [];
      decks.on('value', function (snap) {

        for (var deck in snap.val()) {

          var question = snap.val()[deck]['question'];
          var answer = snap.val()[deck]['answer'];
          var card = new Card(question, answer);
          arr.push(card);
        }
        firstQuestion(arr);
      });
      return arr;

    }

    function firstQuestion(listofcards) {
      displayQuestion(listofcards[cardIndex].question, listofcards[cardIndex].answer, listofcards[cardIndex].questionNumber);
    }

    function nextQuestion() {
      if (cardIndex == cards.length - 1) {
        cardIndex = 0;
      } else{
        cardIndex++;
      }
      displayQuestion(cards[cardIndex].question, cards[cardIndex].answer, cards[cardIndex].questionNumber);
      console.log(cardIndex);
      hideAnswer();
    }
    
    function previousQuestion(){
      if (cardIndex == 0){
        cardIndex = cards.length -1;
      } else {
        cardIndex--;
      }
      console.log(cardIndex);
        displayQuestion(cards[cardIndex].question, cards[cardIndex].answer, cards[cardIndex].questionNumber);
      hideAnswer();
      
    }

    function displayQuestion(question, answer, questionNumber) {
      document.getElementsByClassName('question')[0].innerHTML = question;
      document.getElementsByClassName('answer')[0].innerHTML = answer;
      document.getElementsByClassName('question_number')[0].innerHTML = questionNumber;
    };

    function displayDeckName() {
      document.getElementById('deck_name').innerHTML = getDeckName();
    }

    function showAnswer() {
      document.getElementsByClassName('answer')[0].style.visibility = 'visible'; 
      displayAnswer = true;
    }

    function hideAnswer() {
      document.getElementsByClassName('answer')[0].style.visibility = 'hidden';
      displayAnswer = false;
    }

    function toggleAnswer() {
      if (displayAnswer) {
        hideAnswer();
        document.getElementById("get_answer").value = "Show Answer";
      } else {
        showAnswer();
        document.getElementById("get_answer").value = "Hide Answer";
      }
    }
    
    function addAnswer(){
      passDeckName(deckName);
      window.location.href = "create.html";
    }
    function passDeckName(name) {
    sessionStorage.setItem('deckName', name);
    }
    document.getElementById("previous_question").addEventListener('click', previousQuestion);
    document.getElementById("next_question").addEventListener('click', nextQuestion);
    document.getElementById("get_answer").addEventListener('click', toggleAnswer);
    document.getElementById("add_answer").addEventListener('click', addAnswer);

    displayDeckName();
  </script>
</body>

</html>